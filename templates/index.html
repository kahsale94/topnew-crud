<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastro</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }

        button {
            margin-top: 10px;
            padding: 10px 15px;
            cursor: pointer;
        }

        form {
            margin-top: 15px;
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ccc;
            width: 400px;
        }

        label {
            display: block;
            margin-top: 10px;
        }

        input {
            width: 100%;
            padding: 5px;
        }

        .hidden {
            display: none;
        }
    </style>

    <script>
        function toggleForm(id) {
            document.getElementById(id).classList.toggle("hidden");
        }

        async function enviarJSON(event, url, campos) {
            event.preventDefault();

            const data = {};
            campos.forEach(campo => {
                data[campo] = event.target[campo].value;
            });

            const response = await fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                const erro = await response.json();
                alert("Erro: " + JSON.stringify(erro));
                return;
            }

            alert("Cadastro realizado com sucesso!");
            event.target.reset();
        }

        function adicionarItem() {
            const div = document.createElement("div");
            div.classList.add("item");

            div.innerHTML = `
                <label>Produto</label>
                <input type="text" class="produto_nome" required>

                <label>Quantidade</label>
                <input type="number" class="quantidade" value="1" required>

                <label>Valor Unitário</label>
                <input type="number" step="0.01" class="valor_unitario" required>

                <button type="button" onclick="this.parentElement.remove()">Remover</button>
                <hr>
            `;

            document.getElementById("itens").appendChild(div);
        }

        async function enviarPedido(event) {
            event.preventDefault();

            const cliente = document.getElementById("cliente").value;

            const itens = [];
            document.querySelectorAll(".item").forEach(item => {
                itens.push({
                    produto_nome: item.querySelector(".produto_nome").value,
                    quantidade: parseInt(item.querySelector(".quantidade").value),
                    valor_unitario: parseFloat(item.querySelector(".valor_unitario").value)
                });
            });

            const payload = {
                cliente_nome: cliente_nome,
                itens: itens
            };

            const response = await fetch("/pedidos/pedidos", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                alert("Erro ao criar pedido");
                return;
            }

            alert("Pedido criado com sucesso!");
            event.target.reset();
            document.getElementById("itens").innerHTML = "";
            adicionarItem();
        }
    </script>
</head>
<body>

<h1>Sistema de Cadastro</h1>

<!-- CLIENTE -->
<button onclick="toggleForm('form-cliente')">Criar Cliente</button>

<form id="form-cliente"
      class="hidden"
      onsubmit="enviarJSON(event, '/clientes/clientes', ['nome','idade','telefone','email'])">

    <h3>Cadastro de Cliente</h3>

    <label>Nome</label>
    <input type="text" name="nome" required>

    <label>Idade</label>
    <input type="number" name="idade" required>

    <label>Telefone</label>
    <input type="text" name="telefone" required>

    <label>Email</label>
    <input type="email" name="email" required>

    <button type="submit">Salvar Cliente</button>
</form>

<!-- PRODUTO -->
<button onclick="toggleForm('form-produto')">Criar Produto</button>

<form id="form-produto"
      class="hidden"
      onsubmit="enviarJSON(event, '/produtos/produtos', ['nome','descricao','valor','categoria'])">

    <h3>Cadastro de Produto</h3>

    <label>Nome</label>
    <input type="text" name="nome" required>

    <label>Descrição</label>
    <input type="text" name="descricao" required>

    <label>Valor</label>
    <input type="number" step="0.01" name="valor" required>

    <label>Categoria</label>
    <input type="text" name="categoria" required>

    <button type="submit">Salvar Produto</button>
</form>

<!-- PEDIDO -->
<button onclick="toggleForm('form-pedido')">Criar Pedido</button>

<form id="form-pedido" class="hidden" onsubmit="enviarPedido(event)">
    <h3>Cadastro de Pedido</h3>

    <label>Nome do Cliente</label>
    <input type="text" id="cliente_nome" required>

    <h4>Itens do Pedido</h4>

    <div id="itens">
        <div class="item">
            <label>Produto</label>
            <input type="text" class="produto_nome" required>

            <label>Quantidade</label>
            <input type="number" class="quantidade" value="1" required>

            <label>Valor Unitário</label>
            <input type="number" step="0.01" class="valor_unitario" required>

            <hr>
        </div>
    </div>

    <button type="button" onclick="adicionarItem()">Adicionar Produto</button>
    <br><br>

    <button type="submit">Salvar Pedido</button>
</form>

</body>
</html>